function themeRun(e,t,r){e.appVersion=t,e.releaseDate=r}themeRun.$inject=["$rootScope","appVersion","releaseDate"];var meovn=angular.module("meovn",["ui.router","cfp.hotkeys","ngAnimate","toastr","firebase","facebook","CopyToClipboard","angular-web-notification","720kb.tooltips","highcharts-ng","perfect_scrollbar"]).constant("days",3).constant("appVersion","3.0.0").constant("releaseDate","Nov-20, 2017").config(["$stateProvider","$locationProvider","$urlRouterProvider","FacebookProvider",function(e,t,r,a){t.hashPrefix(""),r.otherwise("/"),e.state("home",{url:"/",controller:"OrdersController",templateUrl:"/templates/home.html"}).state("home.details",{url:"order/:id/:mobile/seller_id=:seller",controller:"DetailController",params:{id:null,mobile:null,seller:null},templateUrl:"templates/order.html"}).state("auth",{url:"/auth",controller:"AuthController",templateUrl:"/templates/auth.html"});a.init("1085772744867580")}]).run(themeRun);meovn.config(["$qProvider",function(e){e.errorOnUnhandledRejections(!1)}]),meovn.service("firebaseService",["$firebaseArray","$filter",function(e,t){function r(e,t){e.filter(function(e){})}var a=firebase.database().ref();sourcesArr=e(a.child("sources")),statusesArr=e(a.child("statuses")),membersArr=e(a.child("members")),packsArr=e(a.child("packs"));return{getOldOrderHistory:function(e){return a.child("oldData").child("orders").orderByChild("buyer_mobile").equalTo(e).once("value",function(e){return e})},getBlockedNumber:function(e){return a.child("blocks").orderByChild("mobile").equalTo(e).once("value",function(e){return e})},getCommentForOrder:function(e){var t=[];return a.child("comments").orderByChild("order_id").equalTo(e.id).once("value",function(e){angular.forEach(e.val(),function(e,r){t.push(e)})}),t},addComment:function(e){return a.child("comments").push(e)},removeComment:function(e){return a.child("comments").orderByChild("id").equalTo(e.id).once("value",function(e){e.forEach(function(e){e.ref.remove()})})},findOrderById:function(e){var t=[];return a.child("requests").orderByChild("id").equalTo(e).once("value",function(e){console.log(e.val()),angular.forEach(e.val(),function(e,r){t.push(e)})}),t},getAllStatuses:function(){return statusesArr.$loaded()},updateOrder:function(e){return a.child("orders").orderByChild("id").equalTo(e.id).once("value",function(t){t.forEach(function(t){t.ref.update({seller_will_call_id:e.seller_will_call_id})})})},updateOrderStatus:function(e){return e.updated_at=Date.now(),a.child("orders").orderByChild("id").equalTo(e.id).once("value",function(t){t.forEach(function(t){t.ref.update({status_id:e.status_id,checked_by:e.checked_by,checked_at:e.checked_at,updated_at:e.updated_at}),e.seller_will_call_id?t.ref.child("assign_data").orderByChild("uid").equalTo(e.seller_will_call_id).limitToLast(1).once("value",function(t){t.forEach(function(t){t.ref.update({status_after:e.status_id})})}):t.ref.child("assign_data").orderByChild("uid").limitToLast(1).once("value",function(t){t.forEach(function(t){t.ref.update({status_after:e.status_id})})})})})},updateOrderSellerWillCall:function(e){e.updated_at=Date.now();var t={};return e.seller_will_call_id&&(t={uid:e.seller_will_call_id,assigned_date:Date.now(),status_before:e.status_id},e.assign_data=t),a.child("orders").orderByChild("id").equalTo(e.id).once("value",function(r){r.forEach(function(r){return r.ref.child("assign_data").push(t),r.ref.update({seller_will_call_id:e.seller_will_call_id,updated_at:e.updated_at})})})},getAllSources:function(){return sourcesArr.$loaded()},getAllPacks:function(){return packsArr.$loaded()},getAllMembers:function(){return membersArr.$loaded()},getMember:function(e){return membersArr.$getRecord(e)},getMemberByEmail:function(e){membersArr.$loaded().then(function(){return angular.forEach(membersArr,function(t){return t.email==e?t:null}),null})},submitBlockNumber:function(e){return a.child("blocks").push(e)},getUserOrders:function(e,t){var n=[],o=new Date,i=new Date,s=[];i.setDate(i.getDate()-t),o.setDate(o.getDate()),i=i.getTime(),o=o.getTime(),a.child("orders").once("value",function(t){t.forEach(function(t){t.ref.child("assign_data").orderByChild("uid").equalTo(e).once("value",function(e){e.val()&&e.ref.orderByChild("assigned_date").startAt(i).endAt(o).once("value",function(e){s.push(t.val())})})})});for(var l=[],u=[],c=[],d=[],h=[],f=[],p=0;p<t;p++){var g=new Date;g.setDate(g.getDate()-p);var m=[],b=[],v=[],w=[],_=[];angular.forEach(s,function(t){angular.forEach(t.assign_data,function(r){if(new Date(r.assigned_date).getDate()==g.getDate())r.status_after&&r.status_before!=r.status_after&&r.uid==e&&-1==m.indexOf(t)&&1!=t.status_id&&m.push(t),6==t.status_id&&6==r.status_after&&t.checked_by==e&&t.seller_will_call_id==e&&r.uid==e?-1==b.indexOf(t)&&(a=new Date(t.checked_at)).getDate()==g.getDate()&&b.push(t):!r.status_after||2!=r.status_after&&3!=r.status_after&&7!=r.status_after||r.uid!=e?r.status_after||1!=t.status_id||t.seller_will_call_id!=e||r.uid!=e?-1!=w.indexOf(t)||r.uid!=e||9!=r.status_after&&5!=r.status_after&&8!=r.status_after||w.push(t):-1==_.indexOf(t)&&_.push(t):-1==v.indexOf(t)&&v.push(t);else if(6==t.status_id&&6==r.status_after&&t.checked_by==e&&t.seller_will_call_id==e&&r.uid==e){var a=new Date(t.checked_at);a.getDate()==g.getDate()&&(-1==b.indexOf(t)&&b.push(t),-1==m.indexOf(t)&&m.push(t))}}),6==t.status_id&&t.checked_by==e&&new Date(t.checked_at).getDate()==g.getDate()&&(r(b)&&b.push(t),-1==m.indexOf(t)&&1!=t.status_id&&m.push(t))}),f.push(g.getDate()+"-"+(g.getMonth()+1)),l.push(m),u.push(b),c.push(v),h.push(_),d.push(w)}return n.push(f),n.push(l),n.push(u),n.push(c),n.push(h),n.push(d),n}}}]),meovn.service("supportService",["$firebaseArray","$filter",function(e,t){var r=firebase.database().ref();return{getRequestItemsForUser:function(e){var t=[];return r.child("requests").orderByChild("fromSeller").equalTo(e).once("value",function(e){angular.forEach(e.val(),function(e,r){t.push(e)})}),t},getNewRequestId:function(){return r.child("requests").push().key},submitRequest:function(e){r.child("requests").push(e)},getUserRequests:function(e){var t=new Date,a=[];return r.child("requests").orderByChild("fromSeller").equalTo(e).once("value",function(e){e.forEach(function(e){new Date(e.val().created_at).getDate()==t.getDate()&&a.push(e.val())})}),a}}}]),meovn.controller("AuthController",["$scope","$http","hotkeys","$filter","toastr","toastrConfig","$firebaseArray","Facebook","$copyToClipboard","webNotification","$state",function(e,t,r,a,n,o,i,s,l,u,c){e.email="",e.password="";document.getElementById("btnSignin");var d=firebase.auth();e.signIn=function(t){t.preventDefault(),d.signInWithEmailAndPassword(e.email,e.password).catch(console.log(t.message))},firebase.auth().onAuthStateChanged(function(e){e&&c.go("home")})}]),meovn.controller("MembersController",["$scope","$http","$filter","$window",function(e,t,r,a){e.showPasswordEditBox=!1,e.showMeExpand=!1,e.$parent.child=e,e.toggleShowPasswordEditBox=function(){e.showPasswordEditBox=!e.showPasswordEditBox},e.toggleShowMeExpand=function(){e.showMeExpand=!e.showMeExpand},e.submitPassword=function(t,r){e.changePassword(t,r).then(function(t){e.showPasswordEditBox=!1,a.location.href="/logout"})},e.changePassword=function(e,r){if(e){var a=$("input.newPassword").val();if(!(a.length<8)){var n="v3/changePassword/"+e.id;return t.post(n,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},data:a})}alert("Nhập mật khẩu tổi thiểu 8 ký tự!")}}}]),meovn.controller("OrdersController",["$scope","$http","$rootScope","$timeout","hotkeys","$filter","$state","$stateParams","toastr","toastrConfig","$firebaseArray","Facebook","$copyToClipboard","webNotification","firebaseService","supportService","days",function(e,t,r,a,n,o,i,s,l,u,c,d,h,f,p,g,m){function b(t){d.api("/"+t+"?access_token="+E,function(t){e.currentPageName=t.name}),d.api("/"+t+"/picture?access_token="+E,function(t){t&&t.data?e.currentPageAvatar=t.data.url:e.currentPageAvatar=null}).then(function(){})}function v(t){t?d.api("/"+t+"/picture?height=100&width=100",function(t){e.userAvatar=t.data.url}):e.userAvatar="public/images/default-avatar-contact.svg"}function w(t,r){if(!r)return e.fbContent=null,void(e.fbPhotos=null);e.isPageBusy=!0,d.api("/"+t+"_"+r+"?access_token="+E,function(t){e.fbContent=t}).then(function(){d.api("/"+t+"_"+r+"/attachments?access_token="+E,function(t){if(e.fbPhotos=[],t.data[0].subattachments)for(var r=0;r<t.data[0].subattachments.data.length-1;r++)e.fbPhotos.push(t.data[0].subattachments.data[r].media.image.src);t.data[0].media&&e.fbPhotos.push(t.data[0].media.image.src)}).then(function(){e.isPageBusy=null,k(),C()})})}function _(t){var r=o("filter")(e.sources,{id:t.order_source_id},!0);return r.length?r[0].page_id:null}function y(t){var r=o("filter")(e.packs,{id:t.product_pack_id},!0);return r.length?r[0].post_id:null}function C(){e.comments=p.getCommentForOrder(e.selectedOrder)}function k(){e.oldOrder=[],e.isLoadingOrderHistory=!0,p.getOldOrderHistory(e.selectedOrder.buyer_mobile).then(function(t){t.forEach(function(t){e.oldOrder.push(t.val())}),e.isLoadingOrderHistory=!1})}function D(t,r){t.status_id=r.id;var a={id:firebase.database().ref().child("comments").push().key,order_id:t.id,content:"",created_at:Date.now(),type:1,status_id:r.id,user:e.currentMember.id};6==r.id?(t.checked_by=e.currentMember.id,t.checked_at=Date.now()):(t.checked_by=null,t.checked_at=null),p.updateOrderStatus(t),p.addComment(a),e.comments.push(a),e.commentData={}}function S(){e.showCallLaterDialog=!0}function O(t){e.currentDataDisplay=e.sellerData[t]}function A(t){t||(t=2);var r=new Date,a=new Date;a.setDate(a.getDate()-t),r.setDate(r.getDate()),a=a.getTime(),r=r.getTime(),M.child("orders").orderByChild("created_at").startAt(a).endAt(r).once("value",function(t){var r=[];t.forEach(function(e){r.push(e.val())}),e.orders=r.reverse(),"home.details"==i.$current.name&&(e.pleaseWaitMessage="Loading Order details. Please wait...",angular.forEach(e.orders,function(t,r){t.id===s.id&&e.active(e.orders[r])}))})}function P(e){return!(e.content.length<3)}function $(t){e.requests=g.getUserRequests(t)}var E="EAAPbgSrDvvwBAE83TW0ZCCm83YuFXjaQmyd7UQZC9hHhaumkN8aiscrr0hxvlRZAeVae7HDpY1vv3aIzPZAH3O6QtHipfooGJzZBH1WioeKiUZAZC2pkuUJRoAMNvzh5RtQBHiRzfrG12e7nzYRl4E1h7kTbXRW1VsZD";e.userAvatar=null,e.userLink=null,e.newAvatar=null,e.graphUserAvatar=function(t){d.api("/"+t+"/picture?height=100&width=100",function(t){t&&!t.error||alert("error!"),e.newAvatar=t.data.url})};var x=document.querySelectorAll(".inputfile");Array.prototype.forEach.call(x,function(e){var t=e.nextElementSibling,r=t.innerHTML;e.addEventListener("change",function(e){var a="";(a=this.files&&this.files.length>1?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value.split("\\").pop())?t.querySelector("span").innerHTML=a:t.innerHTML=r})});var T=document.getElementById("select-avatar"),B=T.nextElementSibling;T.addEventListener("change",function(t){var r=t.target.files[0],a=firebase.storage().ref("avatars/"+r.name).put(r);a.on(firebase.storage.TaskEvent.STATE_CHANGED,function(e){var t=e.bytesTransferred/e.totalBytes*100;switch(B.querySelector("span").innerHTML="Upload is "+t.toFixed(2)+"% done",e.state){case firebase.storage.TaskState.PAUSED:case firebase.storage.TaskState.RUNNING:}},function(e){e.code},function(){var t=a.snapshot.downloadURL;e.updateFirebaseUser(t),B.querySelector("span").innerHTML="Select photo..."})}),e.currentMember=null,firebase.auth().onAuthStateChanged(function(t){t?(e.firebaseUser=firebase.auth().currentUser,p.getAllMembers().then(function(t){e.sellers=t,angular.forEach(e.sellers,function(t){t.email==e.firebaseUser.email&&(e.currentMember=t,$(e.currentMember.id))})})):i.go("auth")});var M=firebase.database().ref();e.orders=[],e.comments=[],e.sources=[],e.statuses=[],e.sellers=[],e.packs=[],e.ordersStatusesForFilter=[],e.ordersStatuses=[],e.updateFirebaseUser=function(t){firebase.auth().currentUser.updateProfile({photoURL:t}).then(function(){e.firebaseUser.photoURL=t}).catch(function(e){console.log("error")})},e.showPasswordEditBox=!1,e.toggleShowPasswordEditBox=function(){e.showPasswordEditBox=!e.showPasswordEditBox},e.hidePasswordEditBox=function(){e.showPasswordEditBox=!1},e.oldPassword="",e.newPassword="",e.confirmNewPassword="",e.validNewPassword=!1,e.validationNewPassword=function(){e.newPassword.length<8||e.confirmNewPassword<8||e.newPassword!=e.confirmNewPassword?e.validNewPassword=!1:e.validNewPassword=!0},e.updateFirebaseUserPassword=function(){if(e.validNewPassword&&e.firebaseUser&&e.oldPassword){var t=firebase.auth.EmailAuthProvider.credential(e.firebaseUser.email,e.oldPassword);e.firebaseUser.reauthenticateWithCredential(t).then(function(){e.firebaseUser.updatePassword(e.newPassword).then(function(){e.signOut()}).catch(function(e){console.log(e),console.log("Error while changing password, please try again!")})}).catch(function(e){})}},e.getSourceFromId=function(t){return o("filter")(e.sources,{id:t})[0]},e.getPackFromId=function(t){return o("filter")(e.packs,{id:t})[0]},firebase.database().ref("orders").limitToLast(1).on("child_added",function(t){e.orders.unshift(t.val()),d.api("/"+t.val().fbId+"/picture?height=100&width=100",function(t){t&&!t.error||alert("error!"),e.$apply(function(){e.newAvatar=t.data.url})})}),firebase.database().ref("comments").limitToLast(1).on("child_added",function(e){}),e.defaultToastrConfig=angular.copy(u),e.alertTypes=["success","error","info","warning"],e.isSeaching=!1,e.searchText="",e.isPageBusy=!1,e.isAsideLoading=!0,e.activeStatus=null,e.fbContent=null,e.fbPhotos=[],e.currentPageName="",e.currentPageAvatar="",e.isPostExpanded=!1,e.selectedOrder=null,e.child={},e.signOut=function(){firebase.auth().signOut()},e.newDate=function(e){return new Date(e)},e.toggleExpandPost=function(){e.isPostExpanded=!e.isPostExpanded},e.isShowAll=!1,e.showAlert=function(t,r,a){var n={autoDismiss:!1,positionClass:"toast-bottom-center",type:a,timeOut:"30000",extendedTimeOut:"2000",allowHtml:!1,closeButton:!0,tapToDismiss:!0,progressBar:!1,newestOnTop:!0,maxOpened:0,preventDuplicates:!1,preventOpenDuplicates:!1,title:t,msg:r};angular.extend(e.defaultToastrConfig,n),l[n.type](n.msg,n.title,e.defaultToastrConfig)},e.$on("$destroy",function(){angular.extend(u,e.defaultToastrConfig)}),e.showMyOrders=!1,e.toggleShowMyOrders=function(){e.showMyOrders=!e.showMyOrders},e.getOrderByUid=function(t){return e.orders.filter(function(e){return e.id==t})[0]},e.addToFavourite=function(t,r){t.stopPropagation(),r.seller_will_call_id?e.showAlert("","Oops! This Order has belonged to "+e.getSeller(r.seller_will_call_id).last_name,"error"):(r.seller_will_call_id=e.currentMember.id,p.updateOrderSellerWillCall(r))},e.userCanReleaseOrChangeStatus=function(t){return e.currentMember?1==e.currentMember.is_admin||e.currentMember.id==t.seller_will_call_id:null},e.releaseOrder=function(t,r){if(t.stopPropagation(),!e.userCanReleaseOrChangeStatus)return!1;r.seller_will_call_id=null,p.updateOrderSellerWillCall(r)},e.resetSearch=function(){e.searchText=""},e.toggleShowAll=function(){e.activeStatus=null,e.showMyOrders=!1,e.searchText=""},e.toggleActiveStatus=function(t){e.activeStatus!=t?e.activeStatus=t:e.activeStatus=null},e.pleaseWaitMessage="Select an order to display",e.active=function(t){t&&(e.isPostExpanded=!1,v(t.fbId),b(_(t)),w(_(t),y(t)),e.selectedOrder=t)},e.select=function(t){e.selectedOrder=t},e.isLoadingOrderHistory=!1,e.findUser=function(t){var r=o("filter")(e.sellers,{id:t},!0);return r.length?r[0]:null},e.getStatusById=function(t){var r=o("filter")(e.statuses,{id:t},!0);return r.length?r[0]:null},e.getOrderStatusForOrder=function(t){if(t)for(var r=0;r<e.statuses.length;r++)if(t.status_id==e.statuses[r].id)return e.statuses[r].display_type},e.commentData={},e.loading=!1,e.submitComment=function(t){if(!e.commentData.content)return!1;var r={id:firebase.database().ref().child("comments").push().key,order_id:t.id,content:e.commentData.content,created_at:Date.now(),type:0,status_id:0,user:e.currentMember.id};p.addComment(r),e.comments.push(r),e.commentData={}},e.deleteComment=function(t){if(void 0!=t.id){p.removeComment(t);var r=e.comments.indexOf(t);e.comments.splice(r,1)}},e.updateStatus=function(t,a,n){return(e.showCallLaterDialog||e.showBlockDialog)&&(e.showCallLaterDialog=!1,e.showBlockDialog=!1),t.status_id==n.id?(e.showAlert("","Oops! Trạng thái không thay đổi, xem xét bổ sung comment.","error"),!1):e.userCanReleaseOrChangeStatus(t)?8==n.id?(e.showBlockDialog=!0,L=n,void(r.blockReason="")):5==n.id?(S(),void(q=n)):void D(t,n):(e.showAlert("","Oops! Thay đổi trạng thái Order không thuộc về bạn?","error"),!1)},e.showBlockDialog=!1,e.hideBlockDialog=function(){e.showBlockDialog=!1},r.blockReason="",e.showCallLaterDialog=!1,e.hideCallLaterDialog=function(){e.showCallLaterDialog=!1},r.willCalllLaterMessage="";var q=null;e.submitCallLater=function(t){if(r.willCalllLaterMessage.length<3)return!1;D(t,q);var a={id:firebase.database().ref().child("comments").push().key,order_id:t.id,content:r.willCalllLaterMessage,created_at:Date.now(),type:0,status_id:0,user:e.currentMember.id};p.addComment(a),e.comments.push(a),e.hideCallLaterDialog()};var L=null;e.submitBlockNumber=function(t){var a={id:firebase.database().ref().child("blocks").push().key,mobile:t.buyer_mobile,pack_id:t.product_pack_id,created_at:Date.now(),source_id:t.order_source_id,uid:e.currentMember.id,reason:r.blockReason};r.blockReason.length>3&&(p.submitBlockNumber(a),e.showBlockDialog=!1,D(t,L),r.blockReason="")},e.quickUpdateStatus=function(t){if(!e.selectedOrder)return e.showAlert("","Oops! Please select an Order befor perform this action.","error"),!1;e.changeStatus(e.selectedOrder,t).then(function(r){for(var a=e.orders.length-1;a>=0;a--)e.orders[a].id==e.selectedOrder.id&&(e.orders[a].status_id=t)})},n.add({combo:"shift+c",description:"Chốt nhanh đơn hàng",callback:function(){e.quickUpdateStatus(6)}}),n.add({combo:"shift+m",description:"Hiện thông tin cá nhân của tôi",callback:function(){e.toggleShowMeExpand()}}),e.showMeExpand=!1,e.toggleShowMeExpand=function(){e.showMeExpand=!e.showMeExpand,e.initChart()},n.add({combo:"esc",description:"Thoát",callback:function(){e.hideAllModals()}}),e.getSeller=function(e){if(!e)return null;var t=[];return M.child("members").orderByChild("id").equalTo(e).once("value",function(e){e.forEach(function(e){var r=e.val();t.push(r)})}),t[0]},e.clibboardCoppyLink=function(t){var r=i.href(i.current.name,i.params,{absolute:!0});h.copy(r).then(function(){e.showAlert("","Link đã được copy vào Clipboard.","info")})};var U=[{name:"Đã gọi",data:[0,0,0,0,0,0,0],id:"s1",dashStyle:"ShortDash",color:"#888",lineWidthPlus:"1",lineWidth:"1"},{name:"Đã chốt",data:[0,0,0,0,0,0,0],color:"#8bbc21",borderColor:"#8bbc21",type:"column",id:"s3"},{name:"Thất bại",data:[0,0,0,0,0,0,0],color:"rgb(170,25,25)",borderColor:"rgb(170,25,25)",type:"column",id:"s4"},{name:"Chưa gọi",data:[0,0,0,0,0,0,0],color:"rgba(0, 0, 0, .3)",borderColor:"rgb(38,60,83)",type:"column",id:"s5"},{name:"Khác",data:[0,0,0,0,0,0,0],color:"rgb(72,151,241)",borderColor:"rgb(72,151,241)",type:"column",id:"s6"}];e.chartSeries=[],e.initChart=function(){for(s=0;s<U.length;s++)e.chartConfig.series.push(U[s]);var t=p.getUserOrders(e.currentMember.id,7);e.sellerData=t,e.toggleActivedDataStatus(1);for(var r=[],a=[],n=[],o=[],i=[],s=0;s<t[1].length;s++)r.push(t[1][s].length),a.push(t[2][s].length),n.push(t[3][s].length),o.push(t[4][s].length),i.push(t[5][s].length);e.chartConfig.series[0].data=r,e.chartConfig.series[1].data=a,e.chartConfig.series[2].data=n,e.chartConfig.series[3].data=o,e.chartConfig.series[4].data=i,e.chartConfig.xAxis.categories=t[0]},e.sellerData=[],e.destroyChart=function(){e.chartSeries=[]},e.sellerDataStatusItem={},e.sellerDataStatuses=[],e.currentDataDisplay=null,e.activedDataStatus=0,e.toggleActivedDataStatus=function(t){e.activedDataStatus=t,O(t)},e.currentOrder=null,M.child("orders").on("child_changed",function(t){angular.forEach(e.orders,function(r,n){r.id!==t.val().id||a(function(){angular.copy(t.val(),e.orders[n]),e.$apply()},10)})}),e.chartConfig={chart:{type:"line"},plotOptions:{series:{stacking:"",states:{hover:{lineWidthPlus:1,lineWidth:1}},dataLabels:{enabled:!0,crop:!1,overflow:"none",style:{fontWeight:"300",color:"#FFFFFF"}}}},series:e.chartSeries,title:{text:"My Data in recent 7 days",style:{color:"#fff",fontWeight:"300",fontSize:"24px"}},yAxis:{gridLineColor:"#212121",labels:{style:{color:"#fff"}}},xAxis:{categories:["25/10","26/10","27/10","28/10","29/10","30/10","31/10"],gridLineColor:"#212121",labels:{style:{color:"#fff"}}},responsive:{rules:[{condition:{maxWidth:600,maxHeight:500},chartOptions:{legend:{align:"center",verticalAlign:"bottom",layout:"horizontal"},yAxis:{labels:{align:"left",x:0,y:-5},title:{text:null}},subtitle:{text:null},credits:{enabled:!1}}}]}},e.reflow=function(){e.$broadcast("highchartsng.reflow")},e.quickComments=["Khách hẹn gọi lại vào lúc ...h","Khách yêu cầu gửi ...","Khách đang bận, gọi lại sau ...h","Khách bận, sáng gọi lại"],e.selectQuickComment=function(t){t&&(e.commentData.content=t,e.showQuickComment=!1)},e.showQuickComment=!1,e.toggleShowQuickComment=function(){e.showQuickComment=!e.showQuickComment},e.hideQuickComment=function(){e.showQuickComment=!1},e.clearCommentData=function(){e.commentData.content=""},e.isShowOverlay=!1,e.isShowHelpPanel=!1,e.showHelpPanel=function(){e.isShowHelpPanel=!0,e.isShowOverlay=!0},e.closeHelpPanel=function(){e.isShowHelpPanel=!1,e.isShowOverlay=!1},e.hideAllModals=function(){e.isShowHelpPanel&&e.closeHelpPanel()};e.requests=[],e.requestContent=null,M.child("requests").on("child_changed",function(t){angular.forEach(e.requests,function(r,n){r.id!==t.val().id||a(function(){angular.copy(t.val(),e.requests[n]),e.$apply()},10)})}),e.submitRequest=function(t){if(t){var r={fromSeller:e.currentMember.id,created_at:Date.now(),type:"1",status:"1",order_id:t.id,content:e.requestContent,response:"",buyer_mobile:t.buyer_mobile,buyer_name:t.buyer_name,id:g.getNewRequestId()};P(r)&&(r.created_at=Date.now(),g.submitRequest(r),e.requests.push(r),e.requestContent="")}else e.showAlert("","Oops! Vui lòng chọn Order trước khi gửi request.","error")},e.findOrderById=function(e){p.findOrderById(e)},A(m),p.getAllStatuses().then(function(t){e.statuses=t,e.ordersStatusesForFilter=[],angular.forEach(e.statuses,function(t,r){1==t.active&&1==t.allow_fillter&&e.ordersStatusesForFilter.push(t),1==t.active&&e.ordersStatuses.push(t)})}),p.getAllSources().then(function(t){angular.forEach(t,function(t){1==t.active&&e.sources.push(t)}),e.isAsideLoading=!0,p.getAllPacks().then(function(t){e.packs=t,"home.details"==i.$current.name&&(e.pleaseWaitMessage="Loading Order details. Please wait...",angular.forEach(e.orders,function(t,r){t.id===s.id&&e.active(e.orders[r])})),e.isAsideLoading=!1})}),angular.forEach([{$index:1,title:"Đã gọi",value:1},{$index:2,title:"Đã chốt",value:2},{$index:3,title:"Thất bại",value:3},{$index:4,title:"Chưa gọi",value:4},{$index:5,title:"Trạng thái khác",value:5}],function(t){e.sellerDataStatuses.push(t)})}]),meovn.controller("DetailController",["$scope","$rootScope","$http","$timeout","hotkeys","$filter","$state","$stateParams","toastr","toastrConfig","$firebaseArray","Facebook","$copyToClipboard","webNotification","firebaseService","supportService","days",function(e,t,r,a,n,o,i,s,l,u,c,d,h,f,p,g,m){t.willCalllLaterMessage="",t.blockReason=""}]),meovn.controller("SupportController",["$scope","$http","hotkeys","$filter","$firebaseArray",function(e,t,r,a,n){}]),meovn.directive("myEnter",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which?(e.$apply(function(){e.$eval(r.myEnter),e.submitComment(e.selectedOrder)}),t.preventDefault()):27===t.which&&e.$apply(function(){e.$eval(r.myEnter),e.clearCommentData()})})}}),meovn.directive("requestEnter",function(){return function(e,t,r){t.bind("keydown keypress",function(t){13===t.which?(e.$apply(function(){e.$eval(r.requestEnter),e.submitRequest(e.selectedOrder)}),t.preventDefault()):27===t.which&&e.$apply(function(){e.$eval(r.requestEnter),e.requestContent=""})})}}),meovn.directive("clickOutside",["$document",function(e){return{restrict:"A",scope:{clickOutside:"&"},link:function(t,r,a){e.on("click",function(e){r===e.target||r[0].contains(e.target)||t.$apply(function(){t.$eval(t.clickOutside)})})}}}]),meovn.directive("clickAnywhereButHere",["$document",function(e){return{link:function(t,r,a){var n=function(e){var n=$(r).has(e.target).length>0,o=r[0]==e.target;n||o||t.$apply(a.clickAnywhereButHere)};t.$watch(a.isActive,function(t,r){t!==r&&1==t?e.bind("click",n):t!==r&&0==t&&e.unbind("click",n)})}}}]),meovn.filter("my_filter",function(){return function(e,t){return e.filter(function(e){return t.searchText.length>0&&e.buyer_mobile?-1!==e.buyer_mobile.indexOf(t.searchText)||-1!==e.buyer_name.toUpperCase().indexOf(t.searchText.toUpperCase()):t.showMyOrders&&t.activeStatus?e.seller_will_call_id==t.currentMember.id&&e.status_id==t.activeStatus.id:t.activeStatus?e.status_id==t.activeStatus.id:t.showMyOrders?e.seller_will_call_id==t.currentMember.id:6!=e.status_id&&7!=e.status_id&&8!=e.status_id&&2!=e.status_id})}});